### 死锁
死锁是计算机科学中的一个概念，特别是在操作系统和数据库管理系统中较为常见。  
它指的是这样一种情况：两个或两个以上的进程（或线程）在执行过程中，因为互相等待对方持有的资源而无法继续执行，从而导致所有的进程都处于阻塞状态，如果没有外部干预，这些进程将永远无法继续前进。

#### 死锁发生的四个必要条件
1. 互斥条件：资源不能被多个进程同时使用，只能被一个进程占用。
2. 持有并等待条件：已经持有至少一个资源的进程可以再请求额外的资源。
3. 非抢占条件：已分配给某个进程的资源不能被强制性地夺走，只能被该进程显式释放。
4. 循环等待条件：存在一种进程资源的循环等待链，每个进程已持有下一个进程所请求的资源。

#### 解决死锁的策略
- 预防策略：破坏死锁产生的四个必要条件之一，如限制资源的分配方式，或要求进程一次性申请所有需要的资源。
- 避免策略：动态检查资源分配状态，确保系统不会进入死锁状态，如银行家算法。
- 检测与恢复：允许系统进入可能的死锁状态，但定期检测死锁的存在，并一旦发现就采取措施解除，通常是回滚或撤销一部分进程的工作。
- 超时重试：为可能引起死锁的操作设置超时，超时后回退并重新尝试。

#### 避免死锁的常见方法
1. 避免一个线程同时获取多个锁
2. 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源
3. 尝试使用定时锁，使用 lock.tryLock(timeout) 来替代使用内部锁机制
4. 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况
